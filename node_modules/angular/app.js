var myApp = angular.module("app", ["ngRoute"]);

myApp.config([
    "$routeProvider",
    function ($routeProvider) {
        $routeProvider
            .when("/home", {
                templateUrl: "views/home.html",
            })
            .when("/exercise1", {
                templateUrl: "views/exercise1.html",
            })
            .when("/exercise2", {
                templateUrl: "views/exercise2.html",
            })
            .when("/exercise3", {
                templateUrl: "views/exercise3.html",
            })
            .when("/exercise4", {
                templateUrl: "views/exercise4.html",
            })
            .otherwise({
                redirectTo: "/home",
            });
    },
]);

myApp.controller("ListController", [
    "$scope",
    function ($scope) {
        $scope.items = [];

        $scope.addItem = function () {
            if ($scope.newItem) {
                $scope.items.push($scope.newItem);
                $scope.newItem = "";
            }
        };

        $scope.removeItem = function (index) {
            $scope.items.splice(index, 1);
        };
    },
]);

myApp.controller("PokemonController", [
    "$scope",
    "$http",
    function ($scope, $http) {
        $scope.pokemons = [];

        $http
            .get("https://pokeapi.co/api/v2/pokemon?limit=10")
            .then(function (response) {
                var pokemonsarray = [];

                angular.forEach(response.data.results, function (pokemon) {
                    pokemonsarray.push($http.get(pokemon.url));
                });

                var handleResponses = function (responses) {
                    angular.forEach(responses, function (response) {
                        var pokemonData = {
                            name:
                                response.data.name.charAt(0).toUpperCase() +
                                response.data.name.slice(1),
                            type: response.data.types[0].type.name,
                            height: response.data.height,
                            weight: response.data.weight,
                        };
                        $scope.pokemons.push(pokemonData);
                    });
                };

                var handleError = function (error) {
                    console.error(
                        "Error al obtener los datos de los Pokémon:",
                        error
                    );
                };

                var fetchPokemonData = function () {
                    if (pokemonsarray.length > 0) {
                        var pokemon = pokemonsarray.shift();
                        pokemon
                            .then(function (response) {
                                handleResponses([response]);
                                fetchPokemonData();
                            })
                            .catch(function (error) {
                                handleError(error);
                                fetchPokemonData();
                            });
                    }
                };

                fetchPokemonData();
            })
            .catch(function (error) {
                console.error("Error al obtener la lista de Pokémon:", error);
            });
    },
]);
