var myApp = angular.module("app", ["ngRoute"]); // Create the app module with the ngRoute dependency 


// Configurate the app for Routing with $routeProvider service

myApp.config([
    "$routeProvider",
    function ($routeProvider) {
        $routeProvider
            .when("/home", {
                templateUrl: "views/home.html",
            })
            .when("/exercise1", {
                templateUrl: "views/exercise1.html",
            })
            .when("/exercise2", {
                templateUrl: "views/exercise2.html",
            })
            .when("/exercise3", {
                templateUrl: "views/exercise3.html",
            })
            .when("/exercise4", {
                templateUrl: "views/exercise4.html",
            })
            .otherwise({
                redirectTo: "/home",
            });
    },
]);

// Create the dynamic list with a controller and using $scope service

myApp.controller("ListController", [
    "$scope",
    function ($scope) {
        $scope.items = [];

        $scope.addItem = function () {
            if ($scope.newItem) {
                $scope.items.push($scope.newItem); // Adds the new item to the items array
                $scope.newItem = "";
            }
        };

        $scope.removeItem = function (index) {
            $scope.items.splice(index, 1); // Uses the splice function to remove the item from the array
        };
    },
]);

// Create PokemonController with the services $scope and $http for getting data from the API

myApp.controller("PokemonController", [
    "$scope",
    "$http",
    function ($scope, $http) {
        $scope.pokemons = [];

        $http
            .get("https://pokeapi.co/api/v2/pokemon?limit=10") // Try to establish connection with PokeAPI
            .then(function (response) {
                var pokemonsarray = [];
                angular.forEach(response.data.results, function (pokemon) {
                    pokemonsarray.push($http.get(pokemon.url));
                });

                var handleResponses = function (responses) {
                    angular.forEach(responses, function (response) {
                        var pokemonData = {
                            name:
                                response.data.name.charAt(0).toUpperCase() +
                                response.data.name.slice(1),
                            height: response.data.height,
                            weight: response.data.weight,
                        }; // Create pokemonData structure with the different three variables
                        $scope.pokemons.push(pokemonData); // Add data to the pokemons scope array
                    });
                };

                var handleError = function (error) {
                    console.error(
                        "Error obtaining Pokemon data",
                        error
                    ); // Basic error handling in case data is not received
                };

                var fetchPokemonData = function () {
                    if (pokemonsarray.length > 0) {
                        var pokemon = pokemonsarray.shift(); // We get the first element of the pokemonsarray
                        pokemon
                            .then(function (response) {
                                handleResponses([response]);
                                fetchPokemonData(); // Recursive call to the function
                            })
                            .catch(function (error) {
                                handleError(error);
                                fetchPokemonData(); // Recursive call to the function
                            });
                    }
                };

                fetchPokemonData();
            })
            .catch(function (error) {
                console.error("Error obtaining Pokemon list:", error); // Basic error handling in case connection is not working
            });
    },
]);
